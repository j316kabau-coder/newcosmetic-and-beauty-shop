// 1. Import necessary libraries
import React, { useState, useEffect } from 'react';
import { createRoot } from 'react-dom/client';
import { initializeApp } from 'firebase/app';
import { getAuth, signInWithPopup, GoogleAuthProvider, signOut } from 'firebase/auth';
import { getFirestore, collection, getDocs, addDoc } from 'firebase/firestore';

// 2. Your Firebase Configuration
// **IMPORTANT: Replace these placeholder values with your ACTUAL Firebase Project Config**
const firebaseConfig = {
  apiKey: "AIzaSyD6ohUKDO2XJ-87saqqQIn44iQ6LXuaT9I",
  authDomain: "cosmetics-and-beauty-sho-6a4df.firebaseapp.com",
  projectId: "cosmetics-and-beauty-sho-6a4df",
  storageBucket:  "cosmetics-and-beauty-sho-6a4df.firebasestorage.app",
  messagingSenderId:"250823421101",
  appId: "1:250823421101:web:4b10054761dc4377f56a24"
};


// Initialize Firebase
const app = initializeApp(firebaseConfig);
const auth = getAuth(app);
const db = getFirestore(app);

// Google Auth Provider
const googleProvider = new GoogleAuthProvider();

// 3. Main React Component
const BeautyShop = () => {
    // State for user login status
    const [user, setUser] = useState(null);
    
    // State for products (will be loaded from Firestore)
    const [products, setProducts] = useState([]);
    
    // --- Authentication Functions ---
    
    const handleSignIn = () => {
        signInWithPopup(auth, googleProvider)
            .then((result) => {
                // The signed-in user info.
                setUser(result.user);
            }).catch((error) => {
                console.error("Sign in failed:", error);
            });
    };

    const handleSignOut = () => {
        signOut(auth).then(() => {
            setUser(null);
        }).catch((error) => {
            console.error("Sign out failed:", error);
        });
    };
    
    // --- Database Fetching Function (Placeholder) ---
    
    // This effect runs once when the component mounts to load products.
    useEffect(() => {
        const fetchProducts = async () => {
            // Placeholder for fetching products from the 'products' collection in Firestore
            // const productsCollection = collection(db, "products");
            // const productSnapshot = await getDocs(productsCollection);
            // const productList = productSnapshot.docs.map(doc => ({ id: doc.id, ...doc.data() }));
            
            // Temporary placeholder data until we set up Firestore
            const productList = [
                { id: '1', name: 'Luxury Face Cream', price: 45.99, description: 'Hydrating and firming.', category: 'Skincare' },
            ];
            setProducts(productList);
        };

        fetchProducts();
    }, []);

    // 4. Component Rendering (What the user sees)
    return (
        <div className="beauty-shop-app">
            <header style={{ padding: '20px', backgroundColor: '#f4f4f4', borderBottom: '1px solid #ccc' }}>
                <h1>Cosmetic and Beauty Shop</h1>
                <nav>
                    {user ? (
                        <>
                            <span style={{ marginRight: '15px' }}>Welcome, {user.displayName}</span>
                            <button onClick={handleSignOut}>Sign Out</button>
                        </>
                    ) : (
                        <button onClick={handleSignIn}>Sign In with Google</button>
                    )}
                </nav>
            </header>
            
            <main style={{ padding: '20px' }}>
                <h2>Products ({products.length})</h2>
                {products.map(product => (
                    <div key={product.id} style={{ border: '1px solid #eee', padding: '10px', margin: '10px 0' }}>
                        <h3>{product.name}</h3>
                        <p>${product.price.toFixed(2)}</p>
                        <p>{product.description}</p>
                    </div>
                ))}
            </main>
            
            <footer style={{ padding: '10px 20px', backgroundColor: '#333', color: 'white', textAlign: 'center' }}>
                Â© 2025 Cosmetic and Beauty Shop
            </footer>
        </div>
    );
};

// 5. Render the App into the index.html root
const container = document.getElementById('root');
if (container) {
    const root = createRoot(container);
    root.render(<BeautyShop />);
}
