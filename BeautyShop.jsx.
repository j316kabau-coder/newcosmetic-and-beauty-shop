// 1. Import necessary libraries
import React, { useState, useEffect } from 'react';
import { createRoot } from 'react-dom/client';
import { initializeApp } from 'firebase/app';
import { getAuth, signInWithPopup, GoogleAuthProvider, signOut } from 'firebase/auth';
import { getFirestore, collection, getDocs, addDoc } from 'firebase/firestore';

// 2. Your Firebase Configuration (Keep this section exactly as you configured it)
const firebaseConfig = {
  apiKey: "YOUR_API_KEY", // Make sure this is your actual key
  authDomain: "YOUR_PROJECT_ID.firebaseapp.com",
  projectId: "YOUR_PROJECT_ID",
  storageBucket: "YOUR_PROJECT_ID.appspot.com",
  messagingSenderId: "YOUR_MESSAGING_SENDER_ID",
  appId: "YOUR_APP_ID"
};

// Initialize Firebase
const app = initializeApp(firebaseConfig);
const auth = getAuth(app);
const db = getFirestore(app);
const googleProvider = new GoogleAuthProvider();

// 3. Simple Product Data (Static Data for now)
const initialProducts = [
    { id: 'p1', name: 'Hydrating Serum', price: 29.50, description: 'Deeply moisturizes and plumps the skin.', category: 'Skincare', image: 'serum.jpg' },
    { id: 'p2', name: 'Matte Lipstick (Ruby Red)', price: 18.00, description: 'Long-lasting, non-drying vibrant color.', category: 'Makeup', image: 'lipstick.jpg' },
    { id: 'p3', name: 'Rose Quartz Roller', price: 15.00, description: 'Helps reduce puffiness and tension.', category: 'Tools', image: 'roller.jpg' },
    { id: 'p4', name: 'Bamboo Body Scrub', price: 22.00, description: 'Exfoliates gently for silky-smooth skin.', category: 'Body Care', image: 'scrub.jpg' },
];


// 4. Main React Component
const BeautyShop = () => {
    const [user, setUser] = useState(null);
    const [products, setProducts] = useState(initialProducts); // Use static data for now
    const [cart, setCart] = useState([]);
    const [view, setView] = useState('shop'); // 'shop' or 'cart'

    // --- Authentication Functions (as before) ---
    
    const handleSignIn = () => {
        signInWithPopup(auth, googleProvider)
            .then((result) => {
                setUser(result.user);
            }).catch((error) => {
                console.error("Sign in failed:", error);
            });
    };

    const handleSignOut = () => {
        signOut(auth).then(() => {
            setUser(null);
            setCart([]); // Clear cart on sign out
        }).catch((error) => {
            console.error("Sign out failed:", error);
        });
    };

    // --- Cart Logic ---

    const addToCart = (product) => {
        setCart(prevCart => {
            const existingItem = prevCart.find(item => item.id === product.id);
            if (existingItem) {
                return prevCart.map(item => 
                    item.id === product.id ? { ...item, quantity: item.quantity + 1 } : item
                );
            } else {
                return [...prevCart, { ...product, quantity: 1 }];
            }
        });
    };

    const removeFromCart = (productId) => {
        setCart(prevCart => prevCart.filter(item => item.id !== productId));
    };
    
    const updateQuantity = (productId, delta) => {
        setCart(prevCart => {
            return prevCart.map(item => {
                if (item.id === productId) {
                    const newQuantity = item.quantity + delta;
                    if (newQuantity <= 0) {
                         // Remove if quantity drops to 0 or less
                         return null; 
                    }
                    return { ...item, quantity: newQuantity };
                }
                return item;
            }).filter(Boolean); // Filters out null items (those removed)
        });
    };
    
    // --- Render Helpers ---

    const CartView = () => {
        const total = cart.reduce((sum, item) => sum + item.price * item.quantity, 0);

        return (
            <div className="cart-container">
                <h2>Your Shopping Cart ({cart.length} items)</h2>
                {cart.length === 0 ? (
                    <p>Your cart is empty. Start shopping!</p>
                ) : (
                    <>
                    <div className="cart-items">
                        {cart.map(item => (
                            <div key={item.id} className="cart-item">
                                <div>
                                    <h4>{item.name}</h4>
                                    <p>${item.price.toFixed(2)}</p>
                                </div>
                                <div className="cart-controls">
                                    <button onClick={() => updateQuantity(item.id, -1)}>-</button>
                                    <span>{item.quantity}</span>
                                    <button onClick={() => updateQuantity(item.id, 1)}>+</button>
                                    <button className="remove-btn" onClick={() => removeFromCart(item.id)}>Remove</button>
                                </div>
                            </div>
                        ))}
                    </div>
                    <div className="cart-summary">
                        <h3>Total: ${total.toFixed(2)}</h3>
                        {user ? (
                            <button className="checkout-btn">Proceed to Checkout</button>
                        ) : (
                             <p>Please **Sign In** to checkout.</p>
                        )}
                       
                    </div>
                    </>
                )}
            </div>
        );
    };

    const ShopView = () => (
        <div className="product-grid">
            {products.map(product => (
                <div key={product.id} className="product-card">
                    <div className="product-image-placeholder">{product.category}</div> 
                    <h3>{product.name}</h3>
                    <p className="product-description">{product.description}</p>
                    <div className="product-footer">
                        <span className="product-price">${product.price.toFixed(2)}</span>
                        <button className="add-to-cart-btn" onClick={() => addToCart(product)}>Add to Cart</button>
                    </div>
                </div>
            ))}
        </div>
    );
    
    // 5. Component Rendering (Main Layout)
    return (
        <div className="beauty-shop-app">
            <style jsx global>{`
                /* --- Basic Reset and Typography --- */
                body {
                    font-family: 'Arial', sans-serif;
                    margin: 0;
                    background-color: #f8f8f8;
                    color: #333;
                }
                h1, h2, h3 {
                    color: #e57373; /* Soft Pink/Coral for branding */
                }
                button {
                    padding: 8px 15px;
                    border: none;
                    cursor: pointer;
                    border-radius: 4px;
                    transition: background-color 0.2s;
                }
                
                /* --- Header and Navigation --- */
                .header {
                    background-color: #ffffff;
                    padding: 15px 40px;
                    box-shadow: 0 2px 4px rgba(0, 0, 0, 0.05);
                    display: flex;
                    justify-content: space-between;
                    align-items: center;
                }
                .logo {
                    font-size: 1.8em;
                    font-weight: bold;
                    color: #e57373;
                }
                .nav-buttons button {
                    margin-left: 10px;
                    background-color: #e57373;
                    color: white;
                }
                .nav-buttons button:hover {
                    background-color: #d84343;
                }
                .nav-buttons .cart-btn {
                    background-color: #81c784; /* Green for cart */
                }
                .nav-buttons .cart-btn:hover {
                    background-color: #66bb6a;
                }
                
                /* --- Main Layout --- */
                .main-content {
                    padding: 40px;
                    max-width: 1200px;
                    margin: 0 auto;
                }
                
                /* --- Shop View: Product Grid --- */
                .product-grid {
                    display: grid;
                    grid-template-columns: repeat(auto-fit, minmax(280px, 1fr));
                    gap: 30px;
                }
                .product-card {
                    background-color: white;
                    border: 1px solid #eee;
                    border-radius: 8px;
                    padding: 20px;
                    box-shadow: 0 4px 6px rgba(0, 0, 0, 0.05);
                    display: flex;
                    flex-direction: column;
                }
                .product-image-placeholder {
                    height: 150px;
                    background-color: #f0f4f8;
                    display: flex;
                    align-items: center;
                    justify-content: center;
                    color: #aaa;
                    margin-bottom: 15px;
                    border-radius: 4px;
                }
                .product-description {
                    color: #666;
                    font-size: 0.9em;
                    flex-grow: 1; /* Pushes footer down */
                }
                .product-footer {
                    display: flex;
                    justify-content: space-between;
                    align-items: center;
                    margin-top: 15px;
                }
                .product-price {
                    font-size: 1.3em;
                    font-weight: bold;
                    color: #4CAF50; /* Green price tag */
                }
                .add-to-cart-btn {
                    background-color: #4CAF50;
                    color: white;
                    font-weight: bold;
                }
                .add-to-cart-btn:hover {
                    background-color: #388E3C;
                }
                
                /* --- Cart View --- */
                .cart-container {
                    background-color: white;
                    padding: 30px;
                    border-radius: 8px;
                    box-shadow: 0 4px 12px rgba(0, 0, 0, 0.1);
                }
                .cart-item {
                    display: flex;
                    justify-content: space-between;
                    align-items: center;
                    padding: 15px 0;
                    border-bottom: 1px dashed #eee;
                }
                .cart-controls button {
                    margin: 0 5px;
                    padding: 5px 10px;
                    background-color: #f0f0f0;
                    color: #333;
                }
                .cart-controls .remove-btn {
                    background-color: #ffcdd2;
                    color: #b71c1c;
                    margin-left: 15px;
                }
                .cart-summary {
                    margin-top: 20px;
                    padding-top: 20px;
                    border-top: 2px solid #e57373;
                    text-align: right;
                }
                .checkout-btn {
                    background-color: #e57373;
                    color: white;
                    font-size: 1.1em;
                    padding: 10px 20px;
                    margin-top: 10px;
                }
            `}</style>
            
            <header className="header">
                <div className="logo" onClick={() => setView('shop')}>
                    Cosmetic & Beauty Shop
                </div>
                <div className="nav-buttons">
                    {user ? (
                        <span style={{ marginRight: '15px', color: '#666' }}>Welcome, {user.displayName}</span>
                    ) : (
                        <button onClick={handleSignIn}>Sign In</button>
                    )}
                    
                    <button className="cart-btn" onClick={() => setView('cart')}>
                        ðŸ›’ Cart ({cart.reduce((sum, item) => sum + item.quantity, 0)})
                    </button>
                    
                    {user && (
                        <button onClick={handleSignOut}>Sign Out</button>
                    )}
                </div>
            </header>
            
            <main className="main-content">
                {view === 'shop' ? <ShopView /> : <CartView />}
            </main>
            
        </div>
    );
};

// 6. Render the App into the index.html root
const container = document.getElementById('root');
if (container) {
    const root = createRoot(container);
    root.render(<BeautyShop />);


